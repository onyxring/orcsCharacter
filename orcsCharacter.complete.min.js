function setActiveCharacterId(e){var t=getActiveCharacterId(),r={id:"0",type:"setActiveCharacter",data:e};if(null==self.dispatchEvent)self.onmessage({data:r});else{var a=new CustomEvent("message");a.data=r,self.dispatchEvent(a)}return t}var _sIn=setInterval;setInterval=function(e,t){var r=getActiveCharacterId();_sIn((function(){var t=setActiveCharacterId(r);e(),setActiveCharacterId(t)}),t)};var _sto=setTimeout;function getAttrsAsync(e){var t=getActiveCharacterId(),r=null;return new Promise(((a,c)=>{r=setActiveCharacterId(t);try{getAttrs(e,(e=>{a(e)}))}catch{c()}})).finally((()=>{setActiveCharacterId(r)}))}function setAttrsAsync(e,t){var r=getActiveCharacterId(),a=null;return new Promise(((c,n)=>{a=setActiveCharacterId(r);try{setAttrs(e,t,(e=>{c(e)}))}catch{n()}})).finally((()=>{setActiveCharacterId(a)}))}function getSectionIDsAsync(e){var t=getActiveCharacterId(),r=null;return new Promise(((a,c)=>{r=setActiveCharacterId(t);try{getSectionIDs(e,(e=>{a(e)}))}catch{c()}})).finally((()=>{setActiveCharacterId(r)}))}function getSingleAttrAsync(e){var t=getActiveCharacterId(),r=null;return new Promise(((a,c)=>{r=setActiveCharacterId(t);try{getAttrs([e],(t=>{a(t[e])}))}catch{c()}})).finally((()=>{setActiveCharacterId(r)}))}setTimeout=function(e,t){var r=getActiveCharacterId();_sto((function(){var t=setActiveCharacterId(r);e(),setActiveCharacterId(t)}),t)};class orcsCharacter{static create(){var e=new orcsCharacter;return e.preferNumeric=!0,e.proxy=new Proxy(e,orcsCharacter.#e),e.proxy}_enforceDataType(e){if(!this.preferNumeric)return e;var t=+e;return null==e||null==e?0:isNaN(t)?e:t}static#e={get:(e,t)=>{switch(t){case"cacheAsync":return t=>orcsAttributeCache.createAsync(e,t);case"getEmptyCache":return()=>orcsAttributeCache.create();case"getRepeatingAsync":return async t=>orcsRepeatingSection.createAsync(e,t);case"cacheRepeatingAsync":return async(t,r)=>{var a=await orcsRepeatingSectionCache.createAsync(e,t);return await a.cacheAsync(r),a};case"preferNumeric":return t=>{e.preferNumeric=t};case"getRowFromEvent":return e=>{var t=e.sourceAttribute.match("repeating_([^_]*)_(.{20})_");return orcsRepeatingSection.createRowProxy(t[2],t[1])}}return getSingleAttrAsync(t).then((t=>e._enforceDataType(t)))},set:async(e,t,r)=>{var a='{"'+(t=await Promise.resolve(t))+'":"'+r.toString().replaceAll(/"/gi,'\\"')+'"}';return setAttrsAsync(JSON.parse(a))}}}class orcsAttributeCache{_cache={_isDirty:{}};_parent;static create(e){var t=new orcsAttributeCache;return t._parent=e,new Proxy(t,orcsAttributeCache.#e)}static async createAsync(e,t){var r=new orcsAttributeCache;r._parent=e;var a=new Proxy(r,orcsAttributeCache.#e);return await orcsAttributeCache.cacheAttrsAsync(a,t),a}static async cacheAttrsAsync(e,t){if(null!=t){var r="";t.forEach((e=>{""!=r&&(r+=","),r+=`"${e}"`})),r=`[${r}]`;var a=await getAttrsAsync(JSON.parse(r));for(var c of t){var n=a[c];null!=n&&(e[c]=n)}}}static#e={get:(e,t)=>{switch(t){case"commitAsync":return()=>{var t="";for(var r in e._cache._isDirty)1==e._cache._isDirty[r]&&(e._cache._isDirty[r]=!1,""!=t&&(t+=","),t+='"'+r+'":"'+e._cache[r].toString().replaceAll(/"/gi,'\\"')+'"');return setAttrsAsync(JSON.parse("{"+t+"}"))};case"cacheAttrsAsync":return t=>orcsAttributeCache.cacheAttrsAsync(e,t)}return e._parent._enforceDataType(e._cache[t])},set:(e,t,r)=>(e._cache[t]=r,e._cache._isDirty[t]=!0,r)}}class orcsRepeatingSection extends Array{_parent=null;_sectionName="";static async createAsync(e,t){var r=new orcsRepeatingSection;return r._parent=e,r._sectionName=t,await r.hydrateAsync(),r}createRowProxy(e){return null==e&&(e=generateRowID()),orcsRepeatingSectionRow.create(this,e)}addNew(e){var t=this.createRowProxy();for(var r in null==e&&(e={}),e)t[r]=e[r];return t}async hydrateAsync(){var e=await getSectionIDsAsync(this._key);for(var t of e)this.push(this.createRowProxy(t))}get _key(){return`repeating_${this._sectionName}`}get _rootCharacterObj(){return this._parent}}class orcsRepeatingSectionRow{_parent;_rowId;static create(e,t){var r=new orcsRepeatingSectionRow;return r._rowId=t,r._parent=e,new Proxy(r,orcsRepeatingSectionRow.#t)}static#t={get:(e,t)=>{switch(t){case"delete":return()=>{removeRepeatingRow(e._key)};case"_rowId":return e._rowId}return e._rootCharacterObj.proxy[e._propKey(t)].then((t=>e._rootCharacterObj._enforceDataType(t)))},set:async(e,t,r)=>e._rootCharacterObj.proxy[e._propKey(t)]=r};get _rootCharacterObj(){return this._parent._parent}get _key(){return this._parent._key+"_"+this._rowId}_propKey(e){return this._parent._key+"_"+this._rowId+"_"+e}}class orcsRepeatingSectionCache extends Array{_parent=null;_sectionName="";static async createAsync(e,t){var r=new orcsRepeatingSectionCache;return r._parent=e,r._sectionName=t,await r.hydrateAsync(),r}createRowProxy(e){return null==e&&(e=generateRowID()),orcsRepeatingSectionRowCache.create(this,e)}addNew(e){var t=this.createRowProxy();for(var r in null==e&&(e={}),e)t[r]=e[r];return this.push(t),t}async hydrateAsync(){var e=await getSectionIDsAsync(this._key);for(var t of e)this.push(this.createRowProxy(t))}async commitAsync(){var e={};return this.map((e=>e)).forEach((t=>{t._isDeleted?(removeRepeatingRow(t._proxy._key),this.splice(this.indexOf(t),1)):e={...e,...t.getCommitJson()}})),setAttrsAsync(e)}async cacheAsync(e){var t="";this.forEach((r=>{e.forEach((e=>{""!=t&&(t+=","),t+=`"${r._propKey(e)}"`}))})),t=`[${t}]`;var r=await getAttrsAsync(JSON.parse(t));this.forEach((t=>{e.forEach((e=>{t._cache[e]=r[t._propKey(e)]}))}))}get _key(){return`repeating_${this._sectionName}`}get _rootCharacterObj(){return this._parent}}class orcsRepeatingSectionRowCache{_parent;_rowId;_cache={};_isDirty={};_isDeleted=!1;static create(e,t){var r=new orcsRepeatingSectionRowCache;return r._rowId=t,r._parent=e,r._proxy=r,new Proxy(r,orcsRepeatingSectionRowCache.#r)}static#r={get:(e,t)=>{switch(t){case"_rowId":return e._rowId;case"_proxy":return e._proxy;case"_cache":return e._cache;case"_isDeleted":return e._isDeleted;case"_propKey":return t=>e._propKey(t);case"delete":return()=>{e._isDeleted=!0};case"undelete":return()=>{e._isDeleted=!1};case"getCommitJson":return()=>{if(1==e._isDeleted)return"";var t="";for(var r in e._cache)1==e._isDirty[r]&&(""!=t&&(t+=","),t+='"'+e._propKey(r)+'":"'+e._cache[r].toString().replaceAll(/"/gi,'\\"')+'"');return JSON.parse("{"+t+"}")}}return e._rootCharacterObj._enforceDataType(e._cache[t])},set:(e,t,r)=>(e._isDirty[t]=!0,e._cache[t]=r)};get _rootCharacterObj(){return this._parent._parent}get _key(){return this._parent._key+"_"+this._rowId}_propKey(e){return this._key+"_"+e}}
//--rename pc if you'd prefer.
var pc=orcsCharacter.create();
